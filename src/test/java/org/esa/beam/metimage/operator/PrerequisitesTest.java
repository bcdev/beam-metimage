package org.esa.beam.metimage.operator;

import com.bc.ceres.core.ProgressMonitor;
import org.esa.beam.metimage.math.MetImageHistogram;
import org.esa.beam.util.math.Histogram;
import org.esa.beam.util.math.IndexValidator;
import org.junit.Before;
import org.junit.Test;

import static junit.framework.Assert.assertEquals;
import static junit.framework.Assert.assertTrue;
import static org.esa.beam.GlobalTestTools.equal;

public class PrerequisitesTest {

    @Before
    public void setUp() throws Exception {
    }

    @Test
    public void testComputeHistogram() {
        final double[][] values = new double[][]{
                new double[]{-3, -2, -1, 0, 1, 2, 3, 4},
                new double[]{-2, 0, 2, 4},
                new double[]{0, 1, 2}
        };
        final boolean unsigned = false;

        final MetImageHistogram histogram = new MetImageHistogram(new int[6], -2, 3);
        for (int i = 0; i < values.length; i++) {
            histogram.aggregate(values[i], unsigned, IndexValidator.TRUE, ProgressMonitor.NULL);
        }

        final int[] exp = new int[]{2, 1, 3, 2, 3, 1};
        assertEquals("", equal(exp, histogram.getBinCounts()));

        histogram.computePdf();
        histogram.computeEqualizedPdf();

        System.out.println();
    }

    @Test
    public void testSamplesToMeasureHistograms() {

        // start with a simple measure: solar brightness (rho860 over water, rho600 over land)

        // these are MERIS rho_toa_13 samples (100 cloudy and 200 non-cloudy pixels):
        final double[] merisRho860CloudSamples = new double[]{
                0.15360162, 0.28005034, 0.08141995, 0.08155428, 0.3497656,
                0.15285456, 0.26146826, 0.08141445, 0.08185381, 0.2614545,
                0.15284404, 0.26145038, 0.077594206, 0.08184832, 0.26143712,
                0.27272546, 0.28363952, 0.12186693, 0.084408626, 0.294752,
                0.3749981, 0.15212235, 0.1218587, 0.100298904, 0.21204297,
                0.29783747, 0.1673388, 0.10046418, 0.10029218, 0.2120289,
                0.29781696, 0.16732743, 0.088888146, 0.09949642, 0.17038408,
                0.28517437, 0.12961687, 0.08888215, 0.10917015, 0.17543696,
                0.36402845, 0.11767024, 0.08239077, 0.10916284, 0.17542537,
                0.3640035, 0.11766223, 0.09358338, 0.12514709, 0.18644553,
                0.5143665, 0.106522866, 0.09357707, 0.19000845, 0.4796427,
                0.61498994, 0.09129105, 0.0818894, 0.18999574, 0.479611,
                0.61494786, 0.09128484, 0.0831379, 0.37268704, 0.5957112,
                0.33719718, 0.08427356, 0.0831323, 0.4347586, 0.5956719,
                0.5005299, 0.0798073, 0.081300735, 0.4347297, 0.40480998,
                0.51972485, 0.07980187, 0.08638749, 0.5376044, 0.25051448,
                0.51968926, 0.11733171, 0.086381696, 0.5676209, 0.25049797,
                0.3606243, 0.078940265, 0.07786687, 0.56758314, 0.4431559,
                0.19807456, 0.07893491, 0.07816676, 0.47205153, 0.56579715,
                0.19806102, 0.098700255, 0.07816152, 0.47202015, 0.56575984};

        final double[] merisRho860NoCloudSamples = new double[]{
                0.03484056, 0.032981742, 0.029965084, 0.03255001, 0.053690944,
                0.034838047, 0.03297938, 0.029655565, 0.032547727, 0.053687233,
                0.033895757, 0.03279194, 0.029744955, 0.030186351, 0.03520837,
                0.03420038, 0.03246625, 0.029742852, 0.03719751, 0.027419366,
                0.034197915, 0.032463938, 0.029878242, 0.037194904, 0.027417473,
                0.034133125, 0.031231962, 0.029645532, 0.028831596, 0.031017698,
                0.034314558, 0.031305905, 0.029643435, 0.031140948, 0.031015567,
                0.03394205, 0.031303674, 0.03054551, 0.031138765, 0.025808597,
                0.033939615, 0.031346895, 0.028564882, 0.031472854, 0.027332623,
                0.033690292, 0.031205818, 0.028562862, 0.047036853, 0.027330745,
                0.033471785, 0.031203594, 0.029204208, 0.047033556, 0.027328867,
                0.033469383, 0.03107792, 0.02946222, 0.044114903, 0.027326988,
                0.03278955, 0.030338136, 0.02946014, 0.047232434, 0.03445995,
                0.032494303, 0.030488903, 0.029472869, 0.047229137, 0.03445746,
                0.03249197, 0.03048673, 0.029393649, 0.042543925, 0.033992335,
                0.03319623, 0.03011559, 0.029391576, 0.036599524, 0.033650454,
                0.033285387, 0.029591035, 0.029419646, 0.038712967, 0.03364803,
                0.034097064, 0.029588932, 0.03153143, 0.038710274, 0.03402962,
                0.03409462, 0.030154046, 0.031529218, 0.040659457, 0.03411875,
                0.033922385, 0.029967204, 0.031174133, 0.040656645, 0.033500005,
                0.033248287, 0.03113289, 0.029532408, 0.033129524, 0.025026118,
                0.032922108, 0.031130672, 0.029069832, 0.033127215, 0.03387904,
                0.032919746, 0.031404257, 0.030983618, 0.029850215, 0.033876594,
                0.033085868, 0.030648997, 0.030981429, 0.035156313, 0.033857983,
                0.032621376, 0.030200955, 0.029384542, 0.035153862, 0.03351607,
                0.032619037, 0.030198805, 0.029918404, 0.03902086, 0.033513654,
                0.032815907, 0.030103967, 0.029916292, 0.03573035, 0.033079483,
                0.03298199, 0.030300794, 0.034786902, 0.03572788, 0.0328301,
                0.03331718, 0.030298641, 0.030523993, 0.031982914, 0.033411823,
                0.03331479, 0.03107863, 0.030521847, 0.029307628, 0.033409424,
                0.03438776, 0.030185757, 0.03195935, 0.029305601, 0.033252414,
                0.033416215, 0.03018362, 0.033856194, 0.034861498, 0.033003125,
                0.033413824, 0.030088855, 0.033853814, 0.030659731, 0.033000756,
                0.031658746, 0.03128286, 0.046610054, 0.030657612, 0.032751538,
                0.031809498, 0.031280648, 0.031887524, 0.02749496, 0.03276386,
                0.03180723, 0.029529123, 0.031885285, 0.027493069, 0.03276151,
                0.031220466, 0.02895897, 0.044444058, 0.030772645, 0.031927966,
                0.030848896, 0.028956922, 0.028928334, 0.02503128, 0.031817347,
                0.030846698, 0.028862333, 0.028926315, 0.025029559, 0.032337204,
                0.03084388, 0.029534498, 0.03222943, 0.02502784, 0.032334883};

        int numCloud = merisRho860CloudSamples.length;
        int numNoCloud = merisRho860NoCloudSamples.length;

        int pCloud = numCloud/(numCloud + numNoCloud);
        int pNoCloud = numNoCloud/(numCloud + numNoCloud);

        int numFeatures = 2; // 'cloudy' and 'not cloudy'


    }

}